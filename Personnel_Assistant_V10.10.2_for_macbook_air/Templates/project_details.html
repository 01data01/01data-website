{% extends "base.html" %}

{% block content %}
<div class="bg-white rounded-lg shadow p-6">
    <!-- Project Header -->
    <div class="border-b pb-6 mb-6" style="border-color: {{ project.color }};">
        <div class="flex justify-between items-start">
            <div>
                <h2 class="text-2xl font-bold flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full" style="background-color: {{ project.color }};"></span>
                    {{ project.name }}
                </h2>
                <div class="text-sm text-gray-600 mt-1">
                    {% if project.start_date and project.end_date %}
                        <div>{{ project.start_date|format_date }} to {{ project.end_date|format_date }}</div>
                    {% elif project.start_date %}
                        <div>Started: {{ project.start_date|format_date }}</div>
                    {% elif project.end_date %}
                        <div>Due: {{ project.end_date|format_date }}</div>
                    {% endif %}
                </div>
                {% if project.description %}
                    <p class="text-gray-700 mt-3">{{ project.description }}</p>
                {% endif %}
            </div>
            <div class="space-x-2">
                <button onclick="showProjectDetails('{{ project.id }}')" 
                        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Edit Project
                </button>
                <a href="{{ url_for('projects') }}" 
                   class="inline-block bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200">
                    Back to Projects
                </a>
            </div>
        </div>
    </div>

    <!-- Progress and Stats -->
    <div class="flex flex-wrap gap-6 mb-8">
        <div class="flex-1 bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-700 mb-2">Progress</h3>
            {% if project.milestones %}
                {% set completed = project.milestones|selectattr('completed', 'eq', true)|list|length %}
                {% set total = project.milestones|length %}
                {% set percent = (completed / total * 100)|int if total > 0 else 0 %}
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>{{ completed }} / {{ total }} milestones completed</span>
                        <span>{{ percent }}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-green-500 h-2.5 rounded-full" style="width: {{ percent }}%"></div>
                    </div>
                </div>
            {% else %}
                <p class="text-gray-500 text-sm">No milestones yet</p>
            {% endif %}
        </div>
        
        <div class="flex-1 bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-700 mb-2">Tasks</h3>
            <div class="flex justify-between text-sm">
                <span>{{ project_tasks|length }} total tasks</span>
                <span>{{ project_tasks|selectattr('status', 'eq', 'done')|list|length }} completed</span>
            </div>
        </div>
        
        <div class="flex-1 bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-700 mb-2">Timeline</h3>
            {% if project.start_date and project.end_date %}
                {% set start = project.start_date|parse_to_date %}
                {% set end = project.end_date|parse_to_date %}
                {% set total_days = (end - start).days %}
                {% set elapsed_days = (now().date() - start).days %}
                {% set percent_time = (elapsed_days / total_days * 100)|int if total_days > 0 else 0 %}
                {% set percent_time = 100 if percent_time > 100 else percent_time %}
                {% set percent_time = 0 if percent_time < 0 else percent_time %}
                
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>{{ elapsed_days }} / {{ total_days }} days elapsed</span>
                        <span>{{ percent_time }}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="{% if percent_time > 90 and percent < 90 %}bg-red-500{% else %}bg-blue-500{% endif %} h-2.5 rounded-full" 
                             style="width: {{ percent_time }}%"></div>
                    </div>
                </div>
            {% else %}
                <p class="text-gray-500 text-sm">No timeline defined</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Milestones Section -->
    <div class="mb-8">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold">Milestones</h3>
            <button onclick="document.getElementById('add-milestone-modal').classList.remove('hidden')" 
                    class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                Add Milestone
            </button>
        </div>
        
        <div class="space-y-3">
            {% if project.milestones %}
                {% for milestone in project.milestones|sort(attribute='due_date') %}
                    <div class="border rounded-lg p-3 flex items-center justify-between {% if milestone.completed %}bg-green-50 border-green-200{% endif %}">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" 
                                   class="form-checkbox h-5 w-5 text-blue-600"
                                   {% if milestone.completed %}checked{% endif %}
                                   onchange="updateMilestoneStatus('{{ project.id }}', '{{ milestone.id }}', this.checked)">
                            <div>
                                <h4 class="font-medium {% if milestone.completed %}line-through text-gray-500{% endif %}">{{ milestone.name }}</h4>
                                {% if milestone.due_date %}
                                    <p class="text-sm text-gray-600">Due: {{ milestone.due_date|format_date }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <button onclick="showMilestoneDetails('{{ project.id }}', '{{ milestone.id }}')"
                                class="text-blue-500 hover:text-blue-700">
                            Edit
                        </button>
                    </div>
                {% endfor %}
            {% else %}
                <p class="text-center text-gray-500 py-6">No milestones yet. Add your first milestone to track project progress.</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Project Tasks Section -->
    <div>
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold">Tasks</h3>
            <button onclick="showAddProjectTaskModal()" 
                    class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                Add Task
            </button>
        </div>
        
        <div class="space-y-3">
            {% if project_tasks %}
                <div class="border rounded-lg overflow-hidden">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Task</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for task in project_tasks|sort(attribute='due_date') %}
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="checkbox" 
                                               class="form-checkbox h-5 w-5 text-blue-600"
                                               {% if task.status == 'done' %}checked{% endif %}
                                               onchange="updateTaskStatus('{{ task.id }}', this.checked ? 'done' : 'todo')">
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="text-sm font-medium text-gray-900 {% if task.status == 'done' %}line-through text-gray-500{% endif %}">
                                            {{ task.description }}
                                        </div>
                                        {% if task.is_milestone %}
                                            <span class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-0.5 rounded-full mt-1">Milestone</span>
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-500">
                                            {% if task.due_date %}
                                                {{ task.due_date|format_date }}
                                                {% if task.time %} at {{ task.time|format_time }}{% endif %}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                     {% if task.priority == 1 %}bg-red-100 text-red-800
                                                     {% elif task.priority == 2 %}bg-yellow-100 text-yellow-800
                                                     {% else %}bg-green-100 text-green-800{% endif %}">
                                            {% if task.priority == 1 %}High
                                            {% elif task.priority == 2 %}Medium
                                            {% else %}Low{% endif %}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <button onclick="showTaskDetails('{{ task.id }}', '{{ task.description }}', '{{ task.due_date }}', '{{ task.time }}', {{ task.priority }}, {{ task.reminders|tojson|safe if task.reminders else 'null' }}, {{ task.notes|tojson|safe if task.notes else 'null' }})" 
                                                class="text-blue-500 hover:text-blue-700">
                                            Edit
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-center text-gray-500 py-6">No tasks yet. Add your first task to this project.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Add Milestone Modal -->
<div id="add-milestone-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-[500px] shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium leading-6 text-gray-900">Add Milestone</h3>
                <button type="button" 
                        onclick="document.getElementById('add-milestone-modal').classList.add('hidden')"
                        class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <form action="{{ url_for('add_milestone') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="project_id" value="{{ project.id }}">
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="milestone-name">Milestone Name</label>
                    <input type="text" name="name" id="milestone-name" required
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="milestone-description">Description</label>
                    <textarea name="description" id="milestone-description" rows="2"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500"
                            placeholder="Milestone details..."></textarea>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="milestone-due_date">Due Date</label>
                    <input type="date" name="due_date" id="milestone-due_date" required
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                </div>

                <div class="flex items-center justify-between border-t pt-4">
                    <button type="submit"
                            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200">
                        Add Milestone
                    </button>
                    <button type="button"
                            onclick="document.getElementById('add-milestone-modal').classList.add('hidden')"
                            class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Milestone Modal -->
<div id="edit-milestone-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-[500px] shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium leading-6 text-gray-900">Edit Milestone</h3>
                <button type="button" 
                        onclick="document.getElementById('edit-milestone-modal').classList.add('hidden')"
                        class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <form action="{{ url_for('update_milestone') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="project_id" id="edit-milestone-project-id" value="{{ project.id }}">
                <input type="hidden" name="milestone_id" id="edit-milestone-id">
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="edit-milestone-name">Milestone Name</label>
                    <input type="text" name="name" id="edit-milestone-name" required
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="edit-milestone-description">Description</label>
                    <textarea name="description" id="edit-milestone-description" rows="2"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500"
                            placeholder="Milestone details..."></textarea>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="edit-milestone-due_date">Due Date</label>
                    <input type="date" name="due_date" id="edit-milestone-due_date" required
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                </div>

                <div class="flex items-center justify-between border-t pt-4">
                    <div class="space-x-2">
                        <button type="submit"
                                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200">
                            Update Milestone
                        </button>
                        <button type="button" onclick="deleteMilestone()"
                                class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200">
                            Delete
                        </button>
                    </div>
                    <button type="button"
                            onclick="document.getElementById('edit-milestone-modal').classList.add('hidden')"
                            class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Project Task Modal -->
<div id="add-project-task-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-[600px] shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium leading-6 text-gray-900">Add Task to Project</h3>
                <button type="button" 
                        onclick="document.getElementById('add-project-task-modal').classList.add('hidden')"
                        class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <form action="{{ url_for('add_project_task') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="project_id" value="{{ project.id }}">
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="task-description">Task Description</label>
                    <input type="text" name="description" id="task-description" required
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="task-notes">Notes</label>
                    <textarea name="notes" id="task-notes" rows="2"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500"
                            placeholder="Additional details..."></textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="task-date">Due Date</label>
                        <input type="date" name="date" id="task-date" required
                               value="{{ now().strftime('%Y-%m-%d') }}"
                               class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="task-time">Time (optional)</label>
                        <input type="time" name="time" id="task-time"
                               class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="task-priority">Priority</label>
                    <select name="priority" id="task-priority"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                        <option value="1">High</option>
                        <option value="2" selected>Medium</option>
                        <option value="3">Low</option>
                    </select>
                </div>

                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-gray-700 text-sm font-bold">Reminders</label>
                        <button type="button" onclick="addProjectTaskReminderField()"
                                class="text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors duration-200"
                                id="project-task-add-reminder-btn">
                            Add Reminder
                        </button>
                    </div>
                    <div id="project-task-reminders-container" class="space-y-2">
                        <div class="reminder-field flex gap-2">
                            <input type="number" name="reminder_amount_1" min="1" max="999"
                                   placeholder="e.g. 30"
                                   class="shadow appearance-none border rounded w-20 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                            <select name="reminder_unit_1"
                                    class="shadow appearance-none border rounded flex-1 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                                <option value="minutes">Minutes</option>
                                <option value="hours">Hours</option>
                                <option value="days">Days</option>
                            </select>
                            <button type="button" onclick="this.closest('.reminder-field').remove(); updateProjectTaskReminderButtons();"
                                    class="text-red-500 hover:text-red-700">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between border-t pt-4">
                    <button type="submit"
                            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200">
                        Add Task
                    </button>
                    <button type="button"
                            onclick="document.getElementById('add-project-task-modal').classList.add('hidden')"
                            class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Task Details Modal (reused from main task modal) -->
{% include 'task_details_modal.html' %}

<script>
function updateTaskStatus(taskId, status) {
    fetch(`/update-task-status/${taskId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
        },
        body: JSON.stringify({ status: status })
    }).then(response => {
        if (response.ok) {
            location.reload();
        }
    });
}

function updateMilestoneStatus(projectId, milestoneId, completed) {
    fetch(`/update-milestone-status/${projectId}/${milestoneId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
        },
        body: JSON.stringify({ completed: completed })
    }).then(response => {
        if (response.ok) {
            location.reload();
        }
    });
}

function showMilestoneDetails(projectId, milestoneId) {
    // Fetch milestone details
    fetch(`/api/milestone/${projectId}/${milestoneId}`)
        .then(response => response.json())
        .then(milestone => {
            // Fill the form
            document.getElementById('edit-milestone-project-id').value = projectId;
            document.getElementById('edit-milestone-id').value = milestoneId;
            document.getElementById('edit-milestone-name').value = milestone.name;
            document.getElementById('edit-milestone-description').value = milestone.description || '';
            document.getElementById('edit-milestone-due_date').value = milestone.due_date || '';
            
            // Show the modal
            document.getElementById('edit-milestone-modal').classList.remove('hidden');
        })
        .catch(error => {
            console.error('Error fetching milestone details:', error);
            alert('Error loading milestone details. Please try again.');
        });
}

function deleteMilestone() {
    if (confirm('Are you sure you want to delete this milestone? This action cannot be undone.')) {
        const projectId = document.getElementById('edit-milestone-project-id').value;
        const milestoneId = document.getElementById('edit-milestone-id').value;
        
        fetch(`/delete-milestone/${projectId}/${milestoneId}`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
            }
        }).then(response => {
            if (response.ok) {
                window.location.reload();
            }
        }).catch(error => {
            console.error('Error deleting milestone:', error);
            alert('Error deleting milestone. Please try again.');
        });
    }
}

function showAddProjectTaskModal() {
    document.getElementById('add-project-task-modal').classList.remove('hidden');
}

function addProjectTaskReminderField() {
    const container = document.getElementById('project-task-reminders-container');
    const fields = container.querySelectorAll('.reminder-field');
    const index = fields.length + 1;
    
    if (index > 5) return; // Maximum 5 reminders
    
    const div = document.createElement('div');
    div.className = 'reminder-field flex gap-2';
    div.innerHTML = `
        <input type="number" name="reminder_amount_${index}" min="1" max="999"
               placeholder="e.g. 30"
               class="shadow appearance-none border rounded w-20 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
        <select name="reminder_unit_${index}"
                class="shadow appearance-none border rounded flex-1 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
            <option value="minutes">Minutes</option>
            <option value="hours">Hours</option>
            <option value="days">Days</option>
        </select>
        <button type="button" onclick="this.closest('.reminder-field').remove(); updateProjectTaskReminderButtons();"
                class="text-red-500 hover:text-red-700">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    `;
    container.appendChild(div);
    updateProjectTaskReminderButtons();
}

function updateProjectTaskReminderButtons() {
    const fields = document.querySelectorAll('#project-task-reminders-container .reminder-field');
    const addButton = document.getElementById('project-task-add-reminder-btn');
    addButton.style.display = fields.length >= 5 ? 'none' : 'block';
}
</script>
{% endblock %}